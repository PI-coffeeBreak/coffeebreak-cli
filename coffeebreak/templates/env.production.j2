# CoffeeBreak Production Environment Configuration
# Generated by CoffeeBreak CLI for {{ domain }}
# Generated on: {{ timestamp }}
# Service: {{ service_name | default('api') }}

# =============================================================================
# BASIC CONFIGURATION
# =============================================================================
NODE_ENV=production
LOG_LEVEL={{ log_level | default('info') }}
DEBUG=false

# Application Settings
APP_NAME=CoffeeBreak
APP_VERSION={{ app_version | default('1.0.0') }}
APP_DOMAIN={{ domain }}
APP_URL=https://{{ domain }}

# Server Configuration
{% if service_name == 'api' %}
PORT={{ api_port | default('3000') }}
HOST={{ api_host | default('0.0.0.0') }}
{% elif service_name == 'frontend' %}
PORT={{ frontend_port | default('80') }}
HOST={{ frontend_host | default('0.0.0.0') }}
{% elif service_name == 'events' %}
PORT={{ events_port | default('80') }}
HOST={{ events_host | default('0.0.0.0') }}
{% endif %}

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# PostgreSQL Configuration
{% if postgres_host %}
DATABASE_URL=postgresql://{{ postgres_user | default('coffeebreak') }}:${POSTGRES_PASSWORD}@{{ postgres_host | default('localhost') }}:{{ postgres_port | default('5432') }}/{{ postgres_db | default('coffeebreak') }}
{% else %}
DATABASE_URL=postgresql://{{ postgres_user | default('coffeebreak') }}:${POSTGRES_PASSWORD}@localhost:{{ postgres_port | default('5432') }}/{{ postgres_db | default('coffeebreak') }}
{% endif %}
DATABASE_POOL_MIN={{ db_pool_min | default('2') }}
DATABASE_POOL_MAX={{ db_pool_max | default('20') }}
DATABASE_SSL={{ database_ssl | default('prefer') }}

# MongoDB Configuration
{% if mongodb_host %}
MONGODB_URL=mongodb://{{ mongodb_user | default('coffeebreak') }}:${MONGODB_PASSWORD}@{{ mongodb_host | default('localhost') }}:{{ mongodb_port | default('27017') }}/{{ mongodb_db | default('coffeebreak') }}
{% else %}
MONGODB_URL=mongodb://{{ mongodb_user | default('coffeebreak') }}:${MONGODB_PASSWORD}@localhost:{{ mongodb_port | default('27017') }}/{{ mongodb_db | default('coffeebreak') }}
{% endif %}

# =============================================================================
# MESSAGE QUEUE CONFIGURATION
# =============================================================================

# RabbitMQ Configuration
{% if rabbitmq_host %}
RABBITMQ_URL=amqp://{{ rabbitmq_user | default('coffeebreak') }}:${RABBITMQ_PASSWORD}@{{ rabbitmq_host | default('localhost') }}:{{ rabbitmq_port | default('5672') }}{{ rabbitmq_vhost | default('/coffeebreak') }}
{% else %}
RABBITMQ_URL=amqp://{{ rabbitmq_user | default('coffeebreak') }}:${RABBITMQ_PASSWORD}@localhost:{{ rabbitmq_port | default('5672') }}{{ rabbitmq_vhost | default('/coffeebreak') }}
{% endif %}

# =============================================================================
# AUTHENTICATION CONFIGURATION
# =============================================================================

# Keycloak Configuration
{% if keycloak_host %}
KEYCLOAK_URL=https://{{ keycloak_host | default(domain) }}/auth
KEYCLOAK_REALM={{ keycloak_realm | default('coffeebreak') }}
KEYCLOAK_CLIENT_ID={{ keycloak_client_id | default('coffeebreak-api') }}
{% else %}
KEYCLOAK_URL=https://{{ domain }}/auth
KEYCLOAK_REALM={{ keycloak_realm | default('coffeebreak') }}
KEYCLOAK_CLIENT_ID={{ keycloak_client_id | default('coffeebreak-api') }}
{% endif %}

# JWT Configuration
JWT_ISSUER=https://{{ domain }}/auth/realms/{{ keycloak_realm | default('coffeebreak') }}
JWT_AUDIENCE={{ keycloak_client_id | default('coffeebreak-api') }}

# Session Configuration
SESSION_SECRET=${SESSION_SECRET}
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=strict
SESSION_MAX_AGE={{ session_max_age | default('86400000') }}

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# CORS Configuration
CORS_ORIGINS=https://{{ domain }},https://events.{{ domain }}
{% if additional_cors_origins %}
{% for origin in additional_cors_origins %}
CORS_ORIGINS=${CORS_ORIGINS},{{ origin }}
{% endfor %}
{% endif %}
CORS_CREDENTIALS=true

# Security Headers
HELMET_ENABLED=true
TRUST_PROXY=true

# Rate Limiting
RATE_LIMIT_WINDOW_MS={{ rate_limit_window | default('900000') }}
RATE_LIMIT_MAX={{ rate_limit_max | default('100') }}

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================

# SSL Settings
SSL_ENABLED=true
SSL_CERT_PATH=/etc/ssl/certs/{{ domain }}/fullchain.pem
SSL_KEY_PATH=/etc/ssl/private/{{ domain }}/privkey.pem
SSL_CA_PATH=/etc/ssl/certs/{{ domain }}/chain.pem

# HTTPS Redirect
HTTPS_REDIRECT=true
HSTS_MAX_AGE={{ hsts_max_age | default('31536000') }}

# =============================================================================
# FILE STORAGE CONFIGURATION
# =============================================================================

# Upload Configuration
UPLOAD_MAX_SIZE={{ upload_max_size | default('10485760') }}
UPLOAD_ALLOWED_TYPES={{ upload_allowed_types | default('image/jpeg,image/png,image/gif,application/pdf') }}
UPLOAD_DEST=/opt/coffeebreak/uploads

# Static Files
STATIC_PATH=/opt/coffeebreak/public
STATIC_MAX_AGE={{ static_max_age | default('31536000') }}

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log Configuration
LOG_FORMAT={{ log_format | default('json') }}
LOG_TIMESTAMP=true
LOG_FILE=/var/log/coffeebreak/{{ service_name | default('api') }}.log
LOG_ERROR_FILE=/var/log/coffeebreak/{{ service_name | default('api') }}-error.log
LOG_MAX_SIZE={{ log_max_size | default('10m') }}
LOG_MAX_FILES={{ log_max_files | default('5') }}

# Audit Logging
AUDIT_LOG_ENABLED={{ audit_log_enabled | default('true') }}
AUDIT_LOG_FILE=/var/log/coffeebreak/audit.log

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Health Check
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_INTERVAL={{ health_check_interval | default('30') }}

# Metrics
METRICS_ENABLED={{ metrics_enabled | default('true') }}
METRICS_PATH=/metrics
METRICS_PORT={{ metrics_port | default('9090') }}

# Performance Monitoring
APM_ENABLED={{ apm_enabled | default('false') }}
{% if apm_server_url %}
APM_SERVER_URL={{ apm_server_url }}
{% endif %}

# =============================================================================
# CACHE CONFIGURATION
# =============================================================================

# Redis Configuration (if enabled)
{% if redis_enabled | default(false) %}
REDIS_URL=redis://{{ redis_host | default('localhost') }}:{{ redis_port | default('6379') }}
REDIS_PASSWORD=${REDIS_PASSWORD}
CACHE_TTL={{ cache_ttl | default('3600') }}
{% endif %}

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================

# SMTP Configuration (if enabled)
{% if smtp_enabled | default(false) %}
SMTP_HOST={{ smtp_host }}
SMTP_PORT={{ smtp_port | default('587') }}
SMTP_SECURE={{ smtp_secure | default('true') }}
SMTP_USER={{ smtp_user }}
SMTP_PASSWORD=${SMTP_PASSWORD}
EMAIL_FROM={{ email_from | default('noreply@' + domain) }}
{% endif %}

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Feature Toggles
FEATURE_REGISTRATION={{ feature_registration | default('true') }}
FEATURE_SOCIAL_LOGIN={{ feature_social_login | default('false') }}
FEATURE_FILE_UPLOAD={{ feature_file_upload | default('true') }}
FEATURE_REAL_TIME={{ feature_real_time | default('true') }}
FEATURE_NOTIFICATIONS={{ feature_notifications | default('true') }}

# =============================================================================
# DEVELOPMENT/DEBUG (Production Override)
# =============================================================================

# Override any development settings
DEBUG=false
NODE_ENV=production
DEVELOPMENT_MODE=false
HOT_RELOAD=false
SOURCE_MAPS=false

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================

# Backup Settings
BACKUP_ENABLED={{ backup_enabled | default('true') }}
BACKUP_SCHEDULE={{ backup_schedule | default('0 2 * * *') }}
BACKUP_RETENTION_DAYS={{ backup_retention | default('30') }}
BACKUP_LOCATION={{ backup_location | default('/opt/coffeebreak/backups') }}

# =============================================================================
# SERVICE-SPECIFIC CONFIGURATION
# =============================================================================

{% if service_name == 'api' %}
# API Service Specific
API_TIMEOUT={{ api_timeout | default('30000') }}
API_BODY_LIMIT={{ api_body_limit | default('1mb') }}
API_COMPRESSION=true
API_ETAG=true
{% endif %}

{% if service_name == 'frontend' %}
# Frontend Service Specific
REACT_APP_API_URL=https://{{ domain }}/api
REACT_APP_KEYCLOAK_URL=https://{{ domain }}/auth
REACT_APP_VERSION={{ app_version | default('1.0.0') }}
REACT_APP_BUILD_DATE={{ timestamp }}
GENERATE_SOURCEMAP=false
{% endif %}

{% if service_name == 'events' %}
# Events Service Specific
REACT_APP_API_URL=https://{{ domain }}/api
REACT_APP_KEYCLOAK_URL=https://{{ domain }}/auth
REACT_APP_EVENT_WEBSOCKET_URL=wss://{{ domain }}/api/events/ws
REACT_APP_VERSION={{ app_version | default('1.0.0') }}
GENERATE_SOURCEMAP=false
{% endif %}

# =============================================================================
# CUSTOM CONFIGURATION
# =============================================================================

{% if custom_env_vars %}
# Custom Environment Variables
{% for key, value in custom_env_vars.items() %}
{{ key }}={{ value }}
{% endfor %}
{% endif %}

# =============================================================================
# SECRETS (Loaded from separate files)
# =============================================================================

# NOTE: The following secrets are loaded from separate files for security:
# - POSTGRES_PASSWORD (from /etc/coffeebreak/secrets/postgres_password)
# - MONGODB_PASSWORD (from /etc/coffeebreak/secrets/mongodb_password)
# - RABBITMQ_PASSWORD (from /etc/coffeebreak/secrets/rabbitmq_password)
# - SESSION_SECRET (from /etc/coffeebreak/secrets/session_secret)
# - API_SECRET_KEY (from /etc/coffeebreak/secrets/api_secret_key)
{% if smtp_enabled | default(false) %}
# - SMTP_PASSWORD (from /etc/coffeebreak/secrets/smtp_password)
{% endif %}
{% if redis_enabled | default(false) %}
# - REDIS_PASSWORD (from /etc/coffeebreak/secrets/redis_password)
{% endif %}